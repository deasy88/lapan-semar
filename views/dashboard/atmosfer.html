{% extends '../layout/dashboard.html' %}

{% block content %}
<div class="row">
	<div class="col-lg-12">
    	<h1 class="page-header">
        	{{ title }} <small>DSS SEMAR - DI. Yogyakarta</small>
        </h1>
    </div>

    {% if view==1 %}
    <div class="col-md-12">
	    <form class="form-horizontal" method="post" role="form" onsubmit="return get_data();">
		    <div class="form-group">
		    	<label class="col-md-2">Tanggal</label>
		    	<div class="col-md-3">
		    		<input type="date" name="tanggal" class="form-control" value="{{ data.tanggal }}" />
		    	</div>
		    	<div class="col-md-2">
		    		<button class="btn btn-primary">Tampil</button>
		    	</div>
		    </div>
		</form>
    </div>
    {% endif %}

    <div class="col-md-12">
    	<div id="map" style="width: 100%; height: 500px"></div>
    </div>
</div>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

	<script type="text/javascript">
		var mymap = L.map('map');
		mymap.setView(new L.LatLng(-2, 120), 4);

		// L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
		//     attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		//     maxZoom: 18,
		//     id: 'mapbox.streets',
		//     accessToken: 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw'
		// }).addTo(mymap);

		var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    	var osm = new L.TileLayer(osmUrl, {minZoom: 1, maxZoom: 12, attribution: false});
    	mymap.addLayer(osm);

		function roundToTwo(num) {
	        return +(Math.round(num + "e+2") + "e-2");
	    }

		var bound = mymap.getBounds();
        var bbox = roundToTwo(bound._southWest.lng) + "," + roundToTwo(bound._southWest.lat) + "," + roundToTwo(bound._northEast.lng) + "," + roundToTwo(bound._northEast.lat);

        $.get( 'http://182.23.27.39:8080/wms/wms', {
            request: "GetMetadata",
            item: "layerDetails",
            layerName: "HYCOM/temperature" }, function (metadata) {
            	console.log( "layer detail", metadata);
                    
      //       	$.get( 'http://182.23.27.39:8080/wms/wms', {
		    //         request: "GetMetadata",
		    //         item: "minmax",
		    //         layers: "HYCOM/temperature",
		    //         styles: "default-scalar/seq-GreysRev",
		    //         "VERSION": "1.1.1",
		    //         "BBOX": bbox,
		    //         "srs": "EPSG:4326",
		    //         "crs": "EPSG:4326",
		    //         "height": 100,
		    //         "width": 100,
		    //         "time": metadata.nearestTimeIso}, function (res) {
						// console.log( "minmax", res);

						L.tileLayer.wms( 'http://182.23.27.39:8080/wms/wms', {
				            format: 'image/png',
				            transparent: true,
				            layers: "HYCOM/temperature",
				            version: "1.3.0",
				            styles: "default-scalar/seq-GreysRev",
				            COLORSCALERANGE: "10,100"
				            // res.min + "," + res.max
				        }).addTo(mymap);

		        // }, "JSON");

        }, "JSON");

	</script>

	<style type="text/css">
		.smallmap {
		    width: 100%;
		    height: 600px;
		    border: 1px solid #ccc;
		    display: inherit;
		}
		@media only screen and (max-width: 600px) {
		    body {
		        height           : 100%;
		        margin           : 0;
		        padding          : 0;
		        width            : 100%;
		    }
		    #map {
		        background : #7391ad;
		        width      : 100%;
		    }
		    #map {
		        border : 0;
		        height : 250px;
		    }
		    #title {
		        font-size   : 1.3em;
		        line-height : 2em;
		        text-indent : 1em;
		        margin      : 0;
		        padding     : 0;
		    }
		    #docs {
		        bottom     : 0;
		        padding    : 1em;
		    }
		    #shortdesc {
		        color      : #aaa;
		        font-size  : 0.8em;
		        padding    : 1em;
		        text-align : right;
		    }
		    #tags {
		        display : none;
		    }
		}
		@media only screen and (orientation: landscape) and (max-width: 600px) {
		    #shortdesc {
		       float: right;
		       width: 25%;
		    }
		    #map {
		        width: 70%;
		    }
		    #docs {
		        font-size: 12px;
		    }
		}
	</style>

{% endblock %}