{% extends '../layout/map.html' %}

{% block content %}
	<div id="map" class="smallmap"></div>

	<div class="sideMenu">
	    <div class="form-group" style="padding:0;">
		    <div class="col-sm-2">
		    	<button class="btn btn-xs btn-primary btn-toggle-menu" onclick="toggle_menu(this)"> <i class="fa fa-arrow-right"></i> </button>
	    	</div>
	    </div>
	    <div class="form-group">
	    	<div class="col-md-12" style="padding-top:5px">
		    	<label>Prediksi</label>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<button id="prediksi-arus" class="wms btn btn-primary data-menu not-stack col-md-12" data-key="arus">Arus Laut</button>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<button id="prediksi-suhumukalaut" class="wms btn btn-primary data-menu not-stack col-md-12" data-layeralias="Suhu Muka Laut" data-key="suhumukalaut">Suhu Muka Laut</button>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<button id="prediksi-hujan" class="wms btn btn-primary data-menu not-stack col-md-12" data-layeralias="HUJAN" data-key="hujan">Hujan</button>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<button id="prediksi-angin" class="wms btn btn-primary data-menu not-stack col-md-12" data-layeralias="Angin" data-key="angin">Angin</button>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<label>Pengamatan</label>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<button id="pengamatan-zppi" class="btn btn-primary data-menu stack col-md-12">ZPPI<br/><small>Zona Potensi Penangkapan Ikan</small></button>
		    </div>
		    <div class="col-md-12 adaSub" style="padding-top:5px">
		    	<button id="pengamatan-kapal" class="btn btn-primary data-menu stack col-md-12">Posisi Kapal</button>
		    	<div class="subMenu" hidden>
		    		<div class="form-group">
				    	<div class="col-md-12" style="padding-top:5px">
					    	<label>Tipe kapal</label>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	 <button class="btn btn-primary data-menu tipekapal col-md-12" data-val="36">Hazard-Y</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="37">Passenger</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="38">Cargo</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="39">Future use</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="40">Tanker</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="41">Default</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="42">Other ships</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="43">HSC-Z</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="44">WIG</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="81">Other ship</button>
					    </div>
					    <div class="col-md-12" style="padding-top:5px">
					    	<button class="btn btn-primary data-menu tipekapal col-md-12" data-val="0">UNIDENTIFIED</button>
					    </div>
					</div>		
		    	</div>
		    </div>
		    <div class="col-md-12" style="padding-top:5px">
		    	<button id="pengamatan-awan" class="wms btn btn-primary data-menu not-stack col-md-12" data-layeralias="Awan" data-key="awan">Awan</button>
		    </div>
	    </div>
    </div>
	
	<div style="position: absolute; bottom: 30px; width: 100%; z-index: 2000; display: block;" id="legend-container">
                        <center>
                            <div id="legend-img-container"><img id="legend-img" width="500" height="20" src="http://182.23.27.39:8080/wms/wms?REQUEST=GetLegendGraphic&amp;PALETTE=x-Rainbow&amp;COLORBARONLY=true&amp;WIDTH=500&amp;HEIGHT=25&amp;vertical=false"><span id="legend-unit" style="padding-left: 5px;background-color:#ffffff">m/detik</span><span style="display:inline-block;background-color:none;position:absolute;left:523.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:573.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:623.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:673.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:723.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:773.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:823.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:873.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:923.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:973.5px">|</span><span style="display:inline-block;background-color:none;position:absolute;left:1023.5px">|</span></div>
                            <div id="legend-values" style="position: relative"><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:519.5px">0</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:563.5px">0.2</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:613.5px">0.4</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:663.5px">0.6</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:713.5px">0.8</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:769.5px">1</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:813.5px">1.2</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:863.5px">1.4</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:913.5px">1.6</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:963.5px">1.8</span><span class="legend-values" style="display:inline-block;background-color:#FFFFFF;position:absolute;left:1019.5px">2</span></div>
                        </center>
	</div>
	
	<div id="timerange-container" style="position:absolute;bottom:0px;left:0px;padding:10px;background-color:#FFFFFF;z-index:2000;"><select id="select-date" class="timeRange"><option value="2016-07-25" data-activedateid="2016-07-25">2016-07-25</option><option value="2016-07-26" data-activedateid="2016-07-26">2016-07-26</option><option value="2016-07-27" data-activedateid="2016-07-27">2016-07-27</option><option value="2016-07-28" data-activedateid="2016-07-28">2016-07-28</option><option value="2016-07-29" data-activedateid="2016-07-29">2016-07-29</option><option value="2016-07-30" data-activedateid="2016-07-30">2016-07-30</option></select><select id="select-time" class="timeRange"><option value="2016-07-25T00:00:00.000Z">07:00 WIB</option></select></div>
	
	<div id="data-date-info-zppi" class="data-date-info" style="padding: 5px; position: absolute; left: 50px; top: 10px; z-index: 100; display: block; background-color: rgb(255, 255, 255);">Waktu Data ZPPI : 19-07-2016</div>
	
	<div id="data-date-info-kapal" class="data-date-info" style="padding: 5px; position: absolute; left: 50px; top: 50px; z-index: 100; display: block; background-color: rgb(255, 255, 255);">Waktu Data Kapal : 11-06-2016 Jam 7</div>
	
	<style type="text/css">
		.smallmap {
		    position: absolute;
		    top:54px;
		    left:0;
		    right:0;
		    bottom:0;
		}
		.navbar {
		    margin-bottom:0;
		}
	</style>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

	<script type="text/javascript">
		var map;
		var osmUrl;
		var osmAttrib;
		var osm;
		var wmsserver = 'http://182.23.27.39:8080/wms/wms';
		var layerDefaults = {
	        'id': 'def',
	        'wmsId': 'def',
	        'layer': 'def',
	        'style': 'def',
	        'legend': 'none',
	        'stackedLayer': 'def',
	        'stackedStyle': 'def',
	        'legend': 'def',
	        'alias': 'def',
	        'active': false,
	        'activeDates': null,
	        'supportsTimeseries': false,
	        'minMax': 'auto',
	        'wmsLayer': false,
	        'zIndex': 1,
	        'opacity': 1,
	        'stacked': false,
	        'unit': 'def',
	        'featureInfo': false,
	        'belowMinColor':'extend',
	        'aboveMinColor':'extend',
	        'baseMap':'osm'
	    };
	    var layers = {};
	    layers['arus'] = {
	        'id': 'arus',
	        'wmsId': 'HYCOM',
	        'layer': 'HYCOM/u:v-group',
	        'style': 'vector_fat_arrows/x-Rainbow',
	        'legend': 'x-Rainbow',
	        'alias': 'Arus',
	        'minMax': '0,1.5',
	        'zIndex': 11,
	        'opacity': 1,
	        'unit': 'm/detik',
	        'belowMin':'transparent'
	    };
	    layers['suhumukalaut'] = {
	        'id': 'suhumukalaut',
	        'wmsId': 'HYCOM',
	        'layer': 'HYCOM/temperature',
	        'style': 'default-scalar/x-Sst',
	        'stackedLayer': 'HYCOM/temperature',
	        'stackedStyle': 'default-scalar/x-Sst',
	        'legend': 'x-Sst',
	        'alias': 'Suhu Muka Laut',
	        'minMax': '26,32',
	        'zIndex': 11,
	        'opacity': 1,
	        'unit': 'Celcius'
	    };
	    layers['hujan'] = {
	        'id': 'hujan',
	        'wmsId': 'WRF sadewa',
	        'layer': 'WRF sadewa/RAINFV',
	        'style': 'default-scalar/sadewa',
	        'stackedLayer': 'WRF sadewa/RAINFV',
	        'stackedStyle': 'default-scalar/sadewa',
	        'legend': 'sadewa',
	        'alias': 'Hujan',
	        'minMax': '0.5,5',
	        'zIndex': 11,
	        'opacity': 1,
	        'unit': 'mm/jam',
	        'featureInfo': true,
	        'belowMinColor':'transparent'
	    };
	    layers['angin'] = {
	        'id': 'angin',
	        'wmsId': 'WRF sadewa',
	        'layer': 'WRF sadewa/U10:V10-group',
	        'style': 'default-vector/x-Rainbow',
	        'legend': 'x-Rainbow',
	        'alias': 'Angin',
	        'minMax': 'auto',
	        'zIndex': 11,
	        'opacity': 1,
	        'unit': 'm/detik',
	        'featureInfo': true,
	        'belowMinColor':'extend',
	        'baseMap':'mapbox'
	    };
	    layers['awan'] = {
	        'id': 'awan',
	        'wmsId': 'HIMA',
	        'layer': 'HIMA/ik',
	        'style': 'default-scalar/seq-GreysRev',
	        'stackedLayer': 'HIMA/ik',
	        'stackedStyle': 'default-scalar/seq-GreysRev',
	        'legend': 'seq-GreysRev',
	        'alias': 'awan',
	        'minMax': '200,255',
	        'zIndex': 11,
	        'opacity': 1,
	        'unit': 'Kelvin'
	    };
	    $.each(layers,function(k,v){
	    	layers[k] = $.extend({},layerDefaults,v);
	    });

		function init_map() {
			map = new L.Map('map', {
		        center: [-9.4052245, 109.8969587],
		        zoom: 8
		    });
		    osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
		   	osmAttrib = 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
		    osm = new L.TileLayer(osmUrl, {minZoom: 1, maxZoom: 12, attribution: false});
		    osm.setZIndex(1);
		    map.addLayer(osm);
    		// map.setView(new L.LatLng(-8, 110), 9); focus to jogja
		}

		function roundToTwo(num) {
	        return +(Math.round(num + "e+2") + "e-2");
	    }

		function arus() {
			$.ajaxSetup({
	            "async": true
	        });

			var arus = {
		        'id': 'arus',
		        'wmsId': 'HYCOM',
		        'layer': 'HYCOM/u:v-group',
		        'style': 'vector_fat_arrows/x-Rainbow',
		        'legend': 'x-Rainbow',
		        'alias': 'Arus',
		        'minMax': '0,1.5',
		        'zIndex': 2,
		        'opacity': 1,
		        'unit': 'm/detik',
				'width': 55,
				'height': 55,
		        'belowMin':'transparent'
		    };
		    var drawObj = $.extend({}, layerDefaults, arus);
        	var bound = map.getBounds();
        	var bbox = roundToTwo(bound._southWest.lng) + "," + roundToTwo(bound._southWest.lat) + "," + roundToTwo(bound._northEast.lng) + "," + roundToTwo(bound._northEast.lat);
        	
        	var wmsLayer = L.tileLayer.wms( wmsserver, {
	            format: 'image/png',
	            transparent: true,
	            layers: drawObj.layer,
	            version: "1.1.1",
	            //"BBOX": bbox,
	            styles: drawObj.style,
	            //"time": $("#select-time").val(),
	            BELOWMINCOLOR: drawObj.belowMinColor,
	            COLORSCALERANGE: drawObj.minMax
	        } );

	        wmsLayer.setZIndex( arus.zIndex );
            wmsLayer.setOpacity( arus.opacity );

	        wmsLayer.addTo(map);
		}

		$(document).ready( function(){
			init_map();
			arus();
		});

		function toggle_menu( th ) {
			var show = $(th).data('show');
			show = (show==undefined) ? true:show;
			if( show ) {
				$(".sideMenu").animate( {right:"-200px"} );
				$(th).data('show', false);
				$(th).find("i").removeClass("fa-arrow-right");
				$(th).find("i").addClass("fa-arrow-left");
			} else {
				$(".sideMenu").animate( {right:"0px"} );
				$(th).data('show', true);
				$(th).find("i").removeClass("fa-arrow-left");
				$(th).find("i").addClass("fa-arrow-right");
			}
		}
	</script>

{% endblock %}